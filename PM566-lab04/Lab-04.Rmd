---
title: "Lab-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## Step 1 Read in the data

```{r packages}
library(data.table)
library(tidyverse)
```


```{r data-read, cache=TRUE}
if (!file.exists("met_all.gz"))
  download.file(
    url = "https://raw.githubusercontent.com/USCbiostats/data-science-data/master/02_met/met_all.gz",
    destfile = "met_all.gz",
    method   = "libcurl",
    timeout  = 60
    )
met <- data.table::fread("met_all.gz")
```


## Step 2 Prepare the data 

```{r data.prep, cache=TRUE}
met <-met[temp >= -17]

met[,table(is.na(temp, na.rm = TRUE))]
met[,table(is.na(rh, na.rm = TRUE))]
met[,table(is.na(wind.sp, na.rm = TRUE))]
met[,table(is.na(vis.dist, na.rm = TRUE))]
met[,table(is.na(dew.point, na.rm = TRUE))]
met[,table(is.na(lat, na.rm = TRUE))]
met[,table(is.na(lon, na.rm = TRUE))]
met[,table(is.na(elev, na.rm = TRUE))]

met[elev == 9999.0, elev := NA]

met[, ymd := as.Data(paste(year, month, day, sep = "-"))]

met[, table(week(ymd))]

met <- met[ week(ymd) ==31 ]

met_avg <- met[, .(
  temp      = mean(temp, na.rm = TRUE),
  rh        = mean(rh, na.rm = TRUE),
  wind.sp   = mean(wind.sp, na.rm = TRUE),
  vis.dist  = mean(vis.dist, na.rm = TRUE),
  dew.point = mean(dew.point, na.rm = TRUE),
  lat       = mean(lat, na.rm = TRUE),
  lon       = mean(lon, na.rm = TRUE),
  elev      = mean(elev, na.rm = TRUE), USAFID
), by = "USAFID"]

met_avg[lat >= 39.71 & lon <= -98, region := "Northwest"]
met_avg[lat < 39.71  & lon <= -98, region := "Southwest"]
met_avg[lat >= 39.71 & lon >  -98, region := "Northeast"]
met_avg[lat < 39.71  & lon >  -98, region := "Southeast"]

## met_avg[, region2 := fifelse(lat >= 39.71 & lon <= -98, "Northwest",
##         fifelse()

met_avg[, table(region, useNA = "always")]

met_avg[, elev_cat :=]
```


## Step 3 Use geom_violin to examine the wind speed and dew point temperature by region 

```{r violin-temp}
ggplot(met_avg, mapping = aes(x=1, y = wind.sp)) +
  geom_violin() +
  facet_grid(~region)
```


## Step 4 Use geom_jitter with stat_smooth to examine the association between dew point temperature and wind speed by region

```{r}

```


## Step 5 Use geom_bar to create barplots of the weather stations by elevation category coloured by region

```{r}

```


## Step 6 Use stat_summary to examine mean dew point and wind speed by region with standard deviation error bars


```{r}
ggplot(met_avg[!is.na(wind.sp) & !is.na(dew.point)]) +
  mapping = aes(x = region, y = wind.sp)
  stat_summary(fun = data)
```


## Step 6 Use stat_summary to examine mean dew point and wind speed by region with standard deviation error bars


```{r}
library(leaflet)

temp.pal <- colorNu
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
